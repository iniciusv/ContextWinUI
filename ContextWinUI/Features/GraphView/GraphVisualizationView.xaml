<UserControl
    x:Class="ContextWinUI.Features.GraphView.GraphVisualizationView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:local="using:ContextWinUI.Features.GraphView"
    mc:Ignorable="d">

	<UserControl.Resources>
		<Style x:Key="ContextButtonStyle" TargetType="Button">
			<Setter Property="Width" Value="22"/>
			<Setter Property="Height" Value="22"/>
			<Setter Property="Padding" Value="0"/>
			<Setter Property="FontSize" Value="10"/>
			<Setter Property="FontWeight" Value="Bold"/>
			<Setter Property="CornerRadius" Value="11"/>
			<Setter Property="Margin" Value="1"/>
			<Setter Property="BorderThickness" Value="1"/>
			<Setter Property="BorderBrush" Value="{ThemeResource CardStrokeColorDefaultBrush}"/>
		</Style>
	</UserControl.Resources>

	<Grid Background="{ThemeResource LayerFillColorDefaultBrush}">
		<Grid.RowDefinitions>
			<RowDefinition Height="Auto"/>
			<RowDefinition Height="*"/>
		</Grid.RowDefinitions>

		<local:GraphLegendControl Grid.Row="0" ViewModel="{x:Bind ViewModel, Mode=OneWay}"/>

		<Pivot Grid.Row="1">
			<PivotItem Header="Análise de Snippet">
				<Grid>
					<Grid.RowDefinitions>
						<RowDefinition Height="Auto"/>
						<RowDefinition Height="*"/>
					</Grid.RowDefinitions>
					<CommandBar Grid.Row="0" Background="Transparent">
						<AppBarButton Icon="Paste" Label="Colar Código IA" Command="{x:Bind ViewModel.PasteSnippetCommand}"/>
					</CommandBar>
					<local:CodeViewerControl Grid.Row="1"
                        Text="{x:Bind ViewModel.SnippetContent, Mode=OneWay}"
                        HighlighterStrategy="{x:Bind ViewModel.SnippetStrategy, Mode=OneWay}" />
				</Grid>
			</PivotItem>

			<PivotItem Header="Consolidação Interativa">
				<Grid>
					<Grid.RowDefinitions>
						<RowDefinition Height="Auto"/>
						<RowDefinition Height="*"/>
					</Grid.RowDefinitions>

					<CommandBar Grid.Row="0" Background="Transparent" DefaultLabelPosition="Right">
						<AppBarButton Icon="Sync" Label="Identificar Contextos" Command="{x:Bind ViewModel.ConsolidateChangesCommand}"/>
						<AppBarSeparator/>
						<AppBarButton Icon="Save" Label="Aplicar Mudanças" 
                                      Command="{x:Bind ViewModel.ApplyToFileCommand}" 
                                      IsEnabled="{x:Bind ViewModel.CanApplyChanges, Mode=OneWay}"/>
					</CommandBar>

					<Grid Grid.Row="1">
						<Grid.ColumnDefinitions>
							<ColumnDefinition Width="*"/>
							<ColumnDefinition Width="80"/>
							<ColumnDefinition Width="*"/>
						</Grid.ColumnDefinitions>

						<Grid Grid.Column="0">
							<local:CodeViewerControl 
                                Text="{x:Bind ViewModel.FileContent, Mode=OneWay}"
                                HighlighterStrategy="{x:Bind ViewModel.Strategy, Mode=OneWay}" />

							<ItemsControl ItemsSource="{x:Bind ViewModel.ContextActions, Mode=OneWay}"
                                          HorizontalAlignment="Right" Width="80">
								<ItemsControl.ItemsPanel>
									<ItemsPanelTemplate>
										<Canvas Background="Transparent" />
									</ItemsPanelTemplate>
								</ItemsControl.ItemsPanel>

								<ItemsControl.ItemContainerStyle>
									<Style TargetType="ContentPresenter">
										<Setter Property="Canvas.Top" Value="{Binding VerticalOffset}" />
										<Setter Property="Canvas.Left" Value="0" />
									</Style>
								</ItemsControl.ItemContainerStyle>

								<ItemsControl.ItemTemplate>
									<DataTemplate x:DataType="local:ContextActionViewModel">
										<StackPanel Orientation="Horizontal" Spacing="2" 
                                                    Background="{ThemeResource SystemControlBackgroundChromeMediumLowBrush}"
                                                    Padding="2" CornerRadius="12" Margin="0,0,5,0">

											<Button Content="V" Style="{StaticResource ContextButtonStyle}"
                                                    Click="ActionButton_Click"
                                                    ToolTipService.ToolTip="Substituir"
                                                    Background="{ThemeResource SystemAccentColorDark1}"/>

											<Button Content="+" Style="{StaticResource ContextButtonStyle}"
                                                    Click="ActionButton_Click"
                                                    ToolTipService.ToolTip="Inserir Abaixo"
                                                    Background="DarkGreen"/>

											<Button Content="*" Style="{StaticResource ContextButtonStyle}"
                                                    Click="ActionButton_Click"
                                                    ToolTipService.ToolTip="Mesclar Símbolos"
                                                    Background="DarkGoldenrod"/>
										</StackPanel>
									</DataTemplate>
								</ItemsControl.ItemTemplate>
							</ItemsControl>
						</Grid>

						<Rectangle Grid.Column="1" Fill="{ThemeResource DividerStrokeColorDefaultBrush}" Width="1" HorizontalAlignment="Center"/>

						<local:CodeViewerControl Grid.Column="2"
                            Text="{x:Bind ViewModel.UnifiedContent, Mode=OneWay}"
                            HighlighterStrategy="{x:Bind ViewModel.SnippetStrategy, Mode=OneWay}" />
					</Grid>
				</Grid>
			</PivotItem>
		</Pivot>
	</Grid>
</UserControl>