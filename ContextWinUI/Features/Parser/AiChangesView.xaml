<UserControl
    x:Class="ContextWinUI.Views.AiChangesView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:controls="using:CommunityToolkit.WinUI.Controls"
    mc:Ignorable="d">

	<Grid>
		<Grid.ColumnDefinitions>
			<ColumnDefinition Width="400" MinWidth="300"/>
			<ColumnDefinition Width="12"/>
			<ColumnDefinition Width="*"/>
		</Grid.ColumnDefinitions>

		<Grid Grid.Column="0" RowDefinitions="Auto,*,Auto,2,*">
			<TextBlock Text="1. Cole a resposta da IA aqui:" Style="{StaticResource SubtitleTextBlockStyle}" Margin="0,0,0,8"/>

			<TextBox Grid.Row="1" 
                     AcceptsReturn="True" 
                     TextWrapping="Wrap" 
                     Text="{x:Bind ViewModel.RawInput, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
                     PlaceholderText="// ARQUIVO: Pasta/Classe.cs ... código ..."
                     FontFamily="Consolas"
                     ScrollViewer.VerticalScrollBarVisibility="Auto"/>

			<StackPanel Grid.Row="2" Orientation="Horizontal" Spacing="8" Margin="0,8">
				<Button Content="Detectar Arquivos" Command="{x:Bind ViewModel.ProcessInputCommand}" Style="{StaticResource AccentButtonStyle}"/>
				<Button Content="Limpar" Command="{x:Bind ViewModel.ClearCommand}"/>
			</StackPanel>

			<controls:GridSplitter Grid.Row="3" ResizeBehavior="BasedOnAlignment" ResizeDirection="Rows" />

			<ListView Grid.Row="4" 
                      ItemsSource="{x:Bind ViewModel.DetectedChanges, Mode=OneWay}"
                      SelectedItem="{x:Bind ViewModel.SelectedChange, Mode=TwoWay}"
                      SelectionMode="Single">
				<ListView.Header>
					<TextBlock Text="2. Arquivos Detectados" Style="{StaticResource SubtitleTextBlockStyle}" Margin="0,8"/>
				</ListView.Header>
				<ListView.ItemTemplate>
					<DataTemplate>
						<Grid Padding="0,8">
							<Grid.ColumnDefinitions>
								<ColumnDefinition Width="Auto"/>
								<ColumnDefinition Width="*"/>
								<ColumnDefinition Width="Auto"/>
							</Grid.ColumnDefinitions>
							<CheckBox IsChecked="{Binding IsSelected, Mode=TwoWay}" VerticalAlignment="Center"/>
							<StackPanel Grid.Column="1" Margin="8,0">
								<TextBlock Text="{Binding FileName}" FontWeight="SemiBold"/>
								<TextBlock Text="{Binding FilePath}" FontSize="10" Foreground="{ThemeResource TextFillColorSecondaryBrush}" TextTrimming="CharacterEllipsis"/>
							</StackPanel>
							<StackPanel Grid.Column="2" HorizontalAlignment="Right">
								<TextBlock Text="{Binding Status}" FontSize="11" HorizontalAlignment="Right"/>
								<TextBlock Text="{Binding ChangeSummary}" FontSize="11" Foreground="{ThemeResource SystemAccentColor}" HorizontalAlignment="Right"/>
							</StackPanel>
						</Grid>
					</DataTemplate>
				</ListView.ItemTemplate>
			</ListView>
		</Grid>

		<controls:GridSplitter Grid.Column="1" ResizeBehavior="BasedOnAlignment" ResizeDirection="Columns" />

		<Grid Grid.Column="2" Margin="0,0,0,0">
			<Grid.RowDefinitions>
				<RowDefinition Height="Auto"/>
				<RowDefinition Height="*"/>
				<RowDefinition Height="Auto"/>
			</Grid.RowDefinitions>

			<CommandBar DefaultLabelPosition="Right" Background="Transparent">
				<AppBarElementContainer VerticalAlignment="Center">
					<TextBlock Text="Visualizacao (Novo Conteúdo)" Style="{StaticResource SubtitleTextBlockStyle}" Margin="12,0"/>
				</AppBarElementContainer>
			</CommandBar>

			<Grid Grid.Row="1" Background="{ThemeResource LayerFillColorDefaultBrush}">
				<RichEditBox x:Name="CodeDiffEditor"
                 IsReadOnly="True"
                 FontFamily="Consolas"
                 FontSize="14"
                 BorderThickness="0"
                 ScrollViewer.VerticalScrollBarVisibility="Auto"
                 ScrollViewer.HorizontalScrollBarVisibility="Auto"
                 HorizontalAlignment="Stretch"
                 VerticalAlignment="Stretch"
                 Padding="12"/>
			</Grid>

			<Border Grid.Row="2" Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" Padding="16" BorderThickness="0,1,0,0" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}">
				<StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Spacing="12">
					<TextBlock Text="Verifique as alterações antes de aplicar." VerticalAlignment="Center" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
					<Button Content="Aplicar Selecionados no Disco" 
                            Command="{x:Bind ViewModel.ApplySelectedChangesCommand}" 
                            Style="{StaticResource AccentButtonStyle}"/>
				</StackPanel>
			</Border>
		</Grid>

		<ProgressRing Grid.ColumnSpan="3" IsActive="{x:Bind ViewModel.IsProcessing, Mode=OneWay}" Width="60" Height="60" Visibility="{x:Bind ViewModel.IsProcessing, Mode=OneWay}"/>
	</Grid>
</UserControl>