<UserControl
    x:Class="ContextWinUI.Views.Components.ContextTreeView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:models="using:ContextWinUI.Models"
    xmlns:components="using:ContextWinUI.Views.Components">

	<Grid>
		<Grid.RowDefinitions>
			<RowDefinition Height="Auto"/>
			<RowDefinition Height="*"/>
		</Grid.RowDefinitions>

		<components:SearchBar Grid.Row="0" SearchCommand="{x:Bind ViewModel.SearchCommand, Mode=OneWay}" Margin="16,8,16,8"/>

		<TreeView Grid.Row="1" x:Name="AnalysisTree"
                  ItemsSource="{x:Bind ViewModel.Items, Mode=OneWay}"
                  SelectionMode="Single"
                  ItemInvoked="TreeView_ItemInvoked">
			<TreeView.ItemTemplate>
				<DataTemplate x:DataType="models:FileSystemItem">
					<TreeViewItem ItemsSource="{x:Bind Children, Mode=OneWay}" 
                                  IsExpanded="{x:Bind IsExpanded, Mode=TwoWay}"
                                  Visibility="{x:Bind Visibility, Mode=OneWay}">
						<TreeViewItem.ContextFlyout>
							<Flyout Opening="OnTagMenuOpening" />
						</TreeViewItem.ContextFlyout>

						<Grid>
							<Grid.ColumnDefinitions>
								<ColumnDefinition Width="Auto"/>
								<ColumnDefinition Width="Auto"/>
								<ColumnDefinition Width="Auto"/>
								<ColumnDefinition Width="*"/>
								<ColumnDefinition Width="Auto"/>
								<ColumnDefinition Width="Auto"/>
							</Grid.ColumnDefinitions>

							<CheckBox Grid.Column="0" IsChecked="{x:Bind IsChecked, Mode=TwoWay}" MinWidth="0" Margin="0,0,8,0"/>
							<FontIcon Grid.Column="1" Glyph="{x:Bind Icon}" FontSize="14" Foreground="{ThemeResource SystemAccentColor}" Margin="0,0,8,0"/>
							<TextBlock Grid.Column="2" Text="{x:Bind Name}" VerticalAlignment="Center" FontSize="13"/>
							<components:TagChipsControl Grid.Column="3" TagsSource="{x:Bind SharedState.Tags, Mode=OneWay}" Margin="8,0,0,0"/>

							<Button Grid.Column="4" Content="&#xE768;" FontSize="10" Width="24" Height="24" Margin="8,0,0,0" Padding="0"
                                    Command="{Binding ElementName=RootTree, Path=ViewModel.AnalyzeMethodFlowCommand}"
                                    CommandParameter="{x:Bind}"
                                    Visibility="{x:Bind MethodFlowVisibility, Mode=OneWay}"/>

							<Button Grid.Column="5" Content="+" FontSize="12" Width="24" Height="24" Margin="4,0,0,0" Padding="0"
                                    Command="{Binding ElementName=RootTree, Path=ViewModel.AnalyzeItemDepthCommand}"
                                    CommandParameter="{x:Bind}"
                                    Visibility="{x:Bind DeepAnalyzeVisibility, Mode=OneWay}"/>
						</Grid>
					</TreeViewItem>
				</DataTemplate>
			</TreeView.ItemTemplate>
		</TreeView>
	</Grid>
</UserControl>