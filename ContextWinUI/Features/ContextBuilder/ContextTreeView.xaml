<UserControl
    x:Class="ContextWinUI.Views.Components.ContextTreeView"
    x:Name="RootTree"  
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:models="using:ContextWinUI.Models"
    xmlns:components="using:ContextWinUI.Views.Components">

	<Grid>
		<Grid.RowDefinitions>
			<RowDefinition Height="Auto"/>
			<RowDefinition Height="*"/>
		</Grid.RowDefinitions>

		<components:SearchBar Grid.Row="0" SearchCommand="{x:Bind ViewModel.SearchCommand, Mode=OneWay}" Margin="8,4,8,4"/>

		<TreeView Grid.Row="1" x:Name="AnalysisTree" 
                  ItemsSource="{x:Bind ViewModel.Items, Mode=OneWay}" 
                  SelectionMode="Single" 
                  ItemInvoked="TreeView_ItemInvoked">

			<TreeView.Resources>
				<x:Double x:Key="TreeViewItemMinHeight">24</x:Double>
			</TreeView.Resources>

			<TreeView.ItemContainerStyle>
				<Style TargetType="TreeViewItem">
					<Setter Property="MinHeight" Value="24" />
					<Setter Property="Padding" Value="0" />
					<Setter Property="Margin" Value="0" />
				</Style>
			</TreeView.ItemContainerStyle>

			<TreeView.ItemTemplate>
				<DataTemplate x:DataType="models:FileSystemItem">

					<Grid Height="24" Margin="-36,0,0,0">
						<Grid.ContextFlyout>
							<Flyout Opening="OnTagMenuOpening" />
						</Grid.ContextFlyout>

						<Grid.ColumnDefinitions>
							<ColumnDefinition Width="Auto"/>
							<ColumnDefinition Width="Auto"/>
							<ColumnDefinition Width="Auto"/>
							<ColumnDefinition Width="*"/>
							<ColumnDefinition Width="Auto"/>
							<ColumnDefinition Width="Auto"/>
						</Grid.ColumnDefinitions>

						<CheckBox Grid.Column="0" IsChecked="{x:Bind IsChecked, Mode=TwoWay}" 
                                  MinWidth="0" Margin="8,0,4,0" VerticalAlignment="Center"/>

						<FontIcon Grid.Column="1" Glyph="{x:Bind Icon}" FontSize="14" Foreground="{ThemeResource SystemAccentColor}" Margin="0,0,8,0"/>
						<TextBlock Grid.Column="2" Text="{x:Bind Name}" VerticalAlignment="Center" FontSize="13"/>
						<components:TagChipsControl Grid.Column="3" TagsSource="{x:Bind SharedState.Tags, Mode=OneWay}" Margin="8,0,0,0"/>

						<Button Grid.Column="4" Content="&#xE768;" 
                            FontSize="10" Width="24" Height="24" Margin="8,0,0,0" Padding="0"
                            Click="OnMethodFlowClick" 
                            ToolTipService.ToolTip="Analisar Fluxo (Chamadas)"
                            Visibility="{x:Bind MethodFlowVisibility, Mode=OneWay}"/>

						<Button Grid.Column="5" 
                            Content="+" 
                            FontSize="12" Width="24" Height="24" Margin="4,0,0,0" Padding="0"
                            Click="OnDeepAnalyzeClick"
                            ToolTipService.ToolTip="Aprofundar análise (Estrutura)"
                            Visibility="{x:Bind DeepAnalyzeVisibility, Mode=OneWay}"/>
					</Grid>
				</DataTemplate>
			</TreeView.ItemTemplate>
		</TreeView>
	</Grid>
</UserControl>