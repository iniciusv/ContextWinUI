<?xml version="1.0" encoding="utf-8"?>
<Window
    x:Class="ContextWinUI.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:models="using:ContextWinUI.Models"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"
    Title="Context WinUI - Explorador de CÃ³digo">

	<Window.SystemBackdrop>
		<MicaBackdrop />
	</Window.SystemBackdrop>

	<Grid>
		<Grid.RowDefinitions>
			<RowDefinition Height="Auto"/>
			<RowDefinition Height="*"/>
			<RowDefinition Height="Auto"/>
		</Grid.RowDefinitions>

		<!-- Toolbar -->
		<Grid Grid.Row="0" Padding="16,8" Background="{ThemeResource CardBackgroundFillColorDefaultBrush}">
			<Grid.ColumnDefinitions>
				<ColumnDefinition Width="Auto"/>
				<ColumnDefinition Width="*"/>
			</Grid.ColumnDefinitions>

			<Button Content="Selecionar Pasta" 
                    Command="{x:Bind ViewModel.BrowseFolderCommand}"
                    Style="{StaticResource AccentButtonStyle}"/>

			<TextBlock Grid.Column="1" 
                       Text="{x:Bind ViewModel.CurrentPath, Mode=OneWay}"
                       VerticalAlignment="Center"
                       Margin="16,0,0,0"
                       TextTrimming="CharacterEllipsis"/>
		</Grid>

		<!-- Main Content -->
		<Grid Grid.Row="1">
			<Grid.ColumnDefinitions>
				<ColumnDefinition Width="350" MinWidth="200"/>
				<ColumnDefinition Width="Auto"/>
				<ColumnDefinition Width="*" MinWidth="300"/>
			</Grid.ColumnDefinitions>

			<!-- Tree View -->
			<Grid Grid.Column="0" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" 
                  BorderThickness="0,1,1,0">
				<Grid.RowDefinitions>
					<RowDefinition Height="Auto"/>
					<RowDefinition Height="*"/>
				</Grid.RowDefinitions>

				<TextBlock Text="Arquivos" 
                           Style="{StaticResource SubtitleTextBlockStyle}"
                           Margin="16,12"/>

				<TreeView Grid.Row="1" 
                          ItemsSource="{x:Bind ViewModel.RootItems, Mode=OneWay}"
                          SelectionMode="Single"
                          ItemInvoked="TreeView_ItemInvoked"
                          Expanding="TreeView_Expanding">
					<TreeView.ItemTemplate>
						<DataTemplate x:DataType="models:FileSystemItem">
							<TreeViewItem ItemsSource="{x:Bind Children, Mode=OneWay}"
                                          IsExpanded="{x:Bind IsExpanded, Mode=TwoWay}">
								<StackPanel Orientation="Horizontal" Spacing="8">
									<FontIcon Glyph="{x:Bind Icon}" FontSize="16"/>
									<TextBlock Text="{x:Bind Name}" VerticalAlignment="Center"/>
									<TextBlock Text="{x:Bind FileSizeFormatted}" 
                                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                               FontSize="11"
                                               VerticalAlignment="Center"
                                               Visibility="{x:Bind IsCodeFile}"/>
								</StackPanel>
							</TreeViewItem>
						</DataTemplate>
					</TreeView.ItemTemplate>
				</TreeView>
			</Grid>

			<!-- Splitter- -->
			<Border Grid.Column="1" Width="8" Background="Transparent"/>

			<!-- Content Viewer -->
			<Grid Grid.Column="2" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" 
                  BorderThickness="0,1,0,0">
				<Grid.RowDefinitions>
					<RowDefinition Height="Auto"/>
					<RowDefinition Height="*"/>
				</Grid.RowDefinitions>

				<!-- Content Header -->
				<Grid Padding="16,12" Background="{ThemeResource CardBackgroundFillColorDefaultBrush}">
					<Grid.ColumnDefinitions>
						<ColumnDefinition Width="*"/>
						<ColumnDefinition Width="Auto"/>
					</Grid.ColumnDefinitions>

					<TextBlock Text="{x:Bind ViewModel.SelectedItem.Name, Mode=OneWay, FallbackValue='Nenhum arquivo selecionado'}"
                               Style="{StaticResource SubtitleTextBlockStyle}"
                               VerticalAlignment="Center"/>

					<Button Grid.Column="1" 
                            Content="Copiar"
                            Command="{x:Bind ViewModel.CopyToClipboardCommand}"
                            Style="{StaticResource AccentButtonStyle}">
						<Button.KeyboardAccelerators>
							<KeyboardAccelerator Key="C" Modifiers="Control"/>
						</Button.KeyboardAccelerators>
					</Button>
				</Grid>

				<!-- Code Content -->
				<ScrollViewer Grid.Row="1" Padding="16">
					<TextBlock Text="{x:Bind ViewModel.FileContent, Mode=OneWay}"
                               FontFamily="Cascadia Code, Consolas, Courier New"
                               FontSize="13"
                               IsTextSelectionEnabled="True"
                               TextWrapping="NoWrap"/>
				</ScrollViewer>

				<!-- Loading Indicator -->
				<Grid Grid.Row="1" 
                      Background="{ThemeResource LayerFillColorDefaultBrush}"
                      Visibility="{x:Bind ViewModel.IsLoading, Mode=OneWay}">
					<ProgressRing IsActive="True" Width="50" Height="50"/>
				</Grid>
			</Grid>
		</Grid>

		<!-- Status Bar -->
		<Grid Grid.Row="2" Padding="16,8" Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
              BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="0,1,0,0">
			<TextBlock Text="{x:Bind ViewModel.StatusMessage, Mode=OneWay}"
                       FontSize="12"
                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
		</Grid>
	</Grid>
</Window>