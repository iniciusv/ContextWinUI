<Window
    x:Class="ContextWinUI.MainWindow"
    x:Name="RootWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:controls="using:CommunityToolkit.WinUI.Controls"
    xmlns:views="using:ContextWinUI.Views"
    xmlns:graph="using:ContextWinUI.Features.GraphView"
    mc:Ignorable="d"
    Title="Context WinUI - Explorador de Código">

    <Window.SystemBackdrop>
        <MicaBackdrop />
    </Window.SystemBackdrop>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <Grid Grid.Row="0" Padding="16,8" Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="0,0,0,1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <Button Grid.Column="0" 
                    Command="{x:Bind ViewModel.FileExplorer.BrowseFolderCommand}"
                    ToolTipService.ToolTip="Abrir pasta do projeto">
                <StackPanel Orientation="Horizontal" Spacing="8">
                    <FontIcon Glyph="&#xE8B7;" FontSize="16"/>
                    <TextBlock Text="Abrir"/>
                </StackPanel>
            </Button>

            <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="4" Margin="12,0,0,0">
                <Button Command="{x:Bind ViewModel.ImportContextFileCommand}"
                        ToolTipService.ToolTip="Importar arquivo de contexto (.json)">
                    <FontIcon Glyph="&#xE896;" FontSize="16"/>
                </Button>
                <Button Command="{x:Bind ViewModel.ExportContextFileCommand}"
                        ToolTipService.ToolTip="Exportar contexto atual para arquivo (.json)">
                    <FontIcon Glyph="&#xE898;" FontSize="16"/>
                </Button>
                <Button Command="{x:Bind ViewModel.SaveWorkCommand}"
                        Style="{StaticResource AccentButtonStyle}"
                        ToolTipService.ToolTip="Salvar tags, contexto e cache na pasta padrão">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <FontIcon Glyph="&#xE74E;" FontSize="16"/>
                        <TextBlock Text="Salvar"/>
                    </StackPanel>
                </Button>
            </StackPanel>

            <TextBlock Grid.Column="2" 
                       Text="{x:Bind ViewModel.FileExplorer.CurrentPath, Mode=OneWay}"
                       VerticalAlignment="Center"
                       Margin="16,0,0,0"
                       TextTrimming="CharacterEllipsis"
                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>

            <ProgressRing Grid.Column="3" 
                          IsActive="{x:Bind ViewModel.IsLoading, Mode=OneWay}" 
                          Width="20" Height="20" 
                          Visibility="{x:Bind ViewModel.IsLoading, Mode=OneWay}"/>
        </Grid>

        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="450" MinWidth="250"/>
                <ColumnDefinition Width="12"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="12"/>
                <ColumnDefinition Width="350" MinWidth="250"/>
            </Grid.ColumnDefinitions>

            <views:FileExplorerView Grid.Column="0"
                    ExplorerViewModel="{x:Bind ViewModel.FileExplorer}"
                    SelectionViewModel="{x:Bind ViewModel.FileSelection}"
                    FileSelected="OnFileExplorer_FileSelected"/>

            <TextBlock Grid.Column="1" Text="&#xE769;" FontFamily="Segoe MDL2 Assets" HorizontalAlignment="Center" VerticalAlignment="Center" Foreground="{ThemeResource SystemControlForegroundAltMediumHighBrush}" FontSize="8" IsHitTestVisible="False"/>
            <controls:GridSplitter Grid.Column="1" ResizeBehavior="BasedOnAlignment" ResizeDirection="Columns" Background="Transparent" HorizontalAlignment="Stretch"/>

            <Pivot Grid.Column="2">
                <PivotItem Header="Arquivo Atual" Margin="0">
                    <views:FileContentView 
                           ContentViewModel="{x:Bind ViewModel.FileContent}"
                           AnalyzeCommand="{x:Bind ViewModel.AnalyzeContextCommand}"
                           CopySelectedCommand="{x:Bind ViewModel.FileSelection.CopySelectedFilesCommand}"/>
                </PivotItem>

                <PivotItem Header="Aplicar IA" Margin="0">
                    <views:AiChangesView ViewModel="{x:Bind ViewModel.AiChanges}" />
                </PivotItem>

                <PivotItem Header="Visualizar Grafo" Margin="0">
                    <graph:GraphVisualizationView ViewModel="{x:Bind ViewModel.GraphVisualization}" />
                </PivotItem>

                <PivotItem Header="Pré-Prompt Global" Margin="0">
                    <views:PrePromptView 
                           ViewModel="{x:Bind ViewModel.PrePrompt}"/>
                </PivotItem>
            </Pivot>

            <TextBlock Grid.Column="3" Text="&#xE769;" FontFamily="Segoe MDL2 Assets" HorizontalAlignment="Center" VerticalAlignment="Center" Foreground="{ThemeResource SystemControlForegroundAltMediumHighBrush}" FontSize="8" IsHitTestVisible="False"/>
            <controls:GridSplitter Grid.Column="3" ResizeBehavior="BasedOnAlignment" ResizeDirection="Columns" Background="Transparent" HorizontalAlignment="Stretch"/>

            <views:ContextAnalysisView Grid.Column="4" 
                                     ContextViewModel="{x:Bind ViewModel.ContextAnalysis}"/>
        </Grid>

        <Grid Grid.Row="2" Padding="16,8" Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="0,1,0,0">
            <TextBlock Text="{x:Bind ViewModel.StatusMessage, Mode=OneWay}"
                       FontSize="12"
                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
        </Grid>
    </Grid>
</Window>